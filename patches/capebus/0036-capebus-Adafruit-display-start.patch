From 1950e77977dabd7c45f08e6fb5b6ea229fe6adae Mon Sep 17 00:00:00 2001
From: Pantelis Antoniou <panto@antoniou-consulting.com>
Date: Tue, 23 Oct 2012 11:50:23 +0300
Subject: [PATCH 36/40] capebus: Adafruit display start

---
 arch/arm/boot/dts/am335x-bone.dts |   37 ++++++++++++++++++++++++++++++++++++-
 1 files changed, 36 insertions(+), 1 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-bone.dts b/arch/arm/boot/dts/am335x-bone.dts
index 28dd89d..df363a3 100644
--- a/arch/arm/boot/dts/am335x-bone.dts
+++ b/arch/arm/boot/dts/am335x-bone.dts
@@ -176,6 +176,13 @@
 				0x164 0x2f	/* ecap0_in_pwm0_out.gpio0_7, INPUT | PULLDIS | MODE7 */
 			>;
 		};
+
+		pwm_bl_pins: pinmux_pwm_bl_pins {
+			pinctrl-single,pins = <
+				0x4c 0x06	/* gpmc_a3.ehrpwm1b, OMAP_MUX_MODE6 | AM33XX_PIN_OUTPUT */
+				// 0x48 0x06       /* gpmc_a2.ehrpwm1a, OMAP_MUX_MODE6 | AM33XX_PIN_OUTPUT */
+			>;
+	       };
 	};
 
 	ocp {
@@ -224,6 +231,7 @@
 			dma-names = "gpioevt";
 			gpio-evt = <&gpio3 2 0>;
 		};
+
 	};
 
 	capebus: capebus@0 {
@@ -250,6 +258,10 @@
 				compatible = "bone-generic-cape";
 			};
 
+			bone_adafruit_cape: cape@5 {
+				compatible = "bone-generic-cape";
+			};
+
 			/* overrides; no EEPROM (prototyping) */
 //			override@3 {
 //				compatible = "bone-capebus-slot-override";
@@ -268,6 +280,15 @@
 //				manufacturer = "CCO Inc";
 //				/* TODO: Add the rest */
 //			};
+
+			override@1 {
+				compatible = "bone-capebus-slot-override";
+				slot = <1>;
+				board-name = "Adafruit 1.8 Cape";
+				version = "00A0";
+				manufacturer = "Adafruit";
+				/* TODO: Add the rest */
+			};
 	};
 };
 
@@ -283,7 +304,6 @@
 		compatible = "at,24c256";
 		reg = <0x50>;
 	};
-       
 };
 
 &i2c2 {
@@ -757,3 +777,18 @@
 	};
 
 };
+
+&bone_adafruit_cape {
+	board-name = "Adafruit 1.8 Cape";
+
+	backlight {
+		compatible	= "pwm-backlight";
+		pinctrl-names	= "default";
+		pinctrl-0	= <&pwm_bl_pins>;
+
+		pwms = <&ehrpwm1 1 500000 0>;
+		pwm-names = "st7735fb";
+		brightness-levels = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100>;
+		default-brightness-level = <50>; /* index to the array above */
+	};
+};
-- 
1.7.7.6

